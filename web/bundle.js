(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
const DEFAULT_ACTIVATION_FUNCTION = sigmoid;
class Neuron {
    constructor(numWeights) {
        this.output = NaN;
        this.weights = [];
        for (let i = 0; i < numWeights; i++)
            this.weights.push(Math.random());
    }
}
exports.Neuron = Neuron;
class NeuralNetwork {
    constructor(numInputs, numHidden, numOutputs) {
        this.numInputs = numInputs;
        this.numHidden = numHidden;
        this.numOutputs = numOutputs;
        // Initialize default params
        this.activationFunc = DEFAULT_ACTIVATION_FUNCTION;
        this.epsilon = 0.5;
        this.acceptableError = 0.001;
        this.maxLearnIterations = 1000;
        // Initialize layers
        this.hiddenLayer = [];
        for (let i = 0; i < numHidden; i++)
            this.hiddenLayer.push(new Neuron(this.numInputs + 1));
        this.outputLayer = [];
        for (let i = 0; i < numOutputs; i++)
            this.outputLayer.push(new Neuron(this.numHidden + 1));
    }
    // -------------------- Forward propagation --------------------
    forwardNeuron(neuron, inputs) {
        if (inputs.length != neuron.weights.length)
            throw new Error(`Invalid size of input array: expecting ${neuron.weights.length}, got ${inputs.length}`);
        let weightedSum = inputs.reduce((accum, input, i) => accum + input * neuron.weights[i], 0);
        neuron.output = this.activationFunc(weightedSum);
        return neuron.output;
    }
    forward(inputs) {
        let hlValues = [];
        let outValues = [];
        this.hiddenLayer.forEach(neuron => hlValues.push(this.forwardNeuron(neuron, this.addBias(inputs))));
        hlValues.push(1); // Add bias
        this.outputLayer.forEach(neuron => outValues.push(this.forwardNeuron(neuron, hlValues)));
        return outValues;
    }
    // -------------------- Back propagation --------------------
    backPropagate(inputs, targets) {
        // Adjust weights for output layer
        let hiddenOuts = this.hiddenLayer.map(neuron => neuron.output);
        let hiddenErrors = [];
        for (let i = 0; i < this.hiddenLayer.length; i++)
            hiddenErrors.push(0);
        for (let i = 0; i < this.outputLayer.length; i++)
            this.backPropagateOutNeuron(this.outputLayer[i], targets[i], this.addBias(hiddenOuts), hiddenErrors);
        // Adjust weights for hidden layer
        for (let i = 0; i < this.hiddenLayer.length; i++)
            this.backPropagateHiddenNeuron(this.hiddenLayer[i], hiddenErrors[i], this.addBias(inputs));
    }
    backPropagateOutNeuron(neuron, target, prevLayerOuts, prevLayerErrors) {
        let delta = (target - neuron.output) * neuron.output * (1 - neuron.output);
        for (let j = 0; j < neuron.weights.length; j++) {
            prevLayerErrors[j] += delta * neuron.weights[j];
            neuron.weights[j] += this.epsilon * delta * prevLayerOuts[j];
        }
        // delta := (D[j] - Y[j]) * Y[j] * (1 - Y[j]);
        // per ogni unità k del livello H (compreso bias)
        //    ErrH[k] := ErrH[k] + (delta * W2[k,j]);
        //    W2[k,j] := W2[k,j] + (epsilon * delta * H[k]);
    }
    backPropagateHiddenNeuron(neuron, error, inputs) {
        let delta = error * neuron.output * (1 - neuron.output);
        for (let j = 0; j < neuron.weights.length; j++)
            neuron.weights[j] += this.epsilon * delta * inputs[j];
        // delta := ErrH[k] * H[k] * (1 - H[k]);
        // per ogni unità i del livello X (compreso bias)
        //    Wl[i,k] := Wl[i,k] + (epsilon * delta * X[i]);
    }
    // -------------------- Iterative learning --------------------
    learn(examples) {
        let iteration = 0;
        let totalError = 0;
        do {
            for (let i = 0; i < examples.length; i++) {
                let actualOuts = this.forward(examples[i].inputs);
                let expectedOuts = examples[i].outputs;
                this.backPropagate(examples[i].inputs, expectedOuts);
                totalError = this.totalError(actualOuts, expectedOuts);
            }
            iteration++;
            this.reportLearn(iteration, totalError);
        } while (iteration < this.maxLearnIterations && totalError > this.acceptableError);
        return iteration;
        // ripeti (* epoche *)
        // 	 per ogni esempio {X,D}
        // 		esegui la rete con X e trova Y;
        // 		backpropagate;
        // 	 fine;
        // 	 calcola errore dell'intera epoca;
        // finché errore dell'epoca inferiore ad errore ammesso
    }
    reportLearn(iteration, totalError) {
        console.log(`Learn iteration ${iteration} - error: ${totalError}`);
    }
    totalError(actualOuts, expectedOuts) {
        const square = x => x * x;
        let sum = actualOuts.reduce((accum, actualOut, i) => accum + square(actualOut - expectedOuts[i]), 0);
        return sum / 2;
    }
    // -------------------- Misc --------------------
    addBias(values) {
        let biasedValues = values.slice();
        biasedValues.push(1);
        return biasedValues;
    }
}
exports.NeuralNetwork = NeuralNetwork;
// -------------------- Activation functions --------------------
function sigmoid(x) {
    if (x < -45.0)
        return 0.0;
    else if (x > 45.0)
        return 1.0;
    else
        return 1.0 / (1.0 + Math.exp(-x));
}

},{}],2:[function(require,module,exports){
"use strict";
const neurons_1 = require('./neurons');
let nn;
$(function () {
    $('input,textarea').on('input', evt => {
        //TODO: validate and activate buttons
    });
    $('#butlearn').click(_ => {
        nn = new neurons_1.NeuralNetwork(3, 4, 3);
        //TODO: learn
    });
    $('#buttest').click(_ => {
        //TODO: test
    });
});

},{"./neurons":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbmV1cm9ucy50cyIsInNyYy9ubm4td2ViLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBLE1BQU0sMkJBQTJCLEdBQUcsT0FBTyxDQUFDO0FBVzVDO0lBSUMsWUFBWSxVQUFrQjtRQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztRQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUU7WUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDbkMsQ0FBQztBQUNGLENBQUM7QUFWWSxjQUFNLFNBVWxCLENBQUE7QUFHRDtJQVNDLFlBQW9CLFNBQWlCLEVBQVUsU0FBaUIsRUFBVSxVQUFrQjtRQUF4RSxjQUFTLEdBQVQsU0FBUyxDQUFRO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBUTtRQUFVLGVBQVUsR0FBVixVQUFVLENBQVE7UUFDM0YsNEJBQTRCO1FBQzVCLElBQUksQ0FBQyxjQUFjLEdBQUcsMkJBQTJCLENBQUM7UUFDbEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFDbkIsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7UUFDN0IsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztRQUMvQixvQkFBb0I7UUFDcEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDdEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEVBQUUsQ0FBQyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUks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QVcsQ0FBQyxDQUFBO0FBRTFDLElBQUksRUFBaUIsQ0FBQztBQUV0QixDQUFDLENBQUM7SUFDRCxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUc7UUFDbEMscUNBQXFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JCLEVBQUUsR0FBRyxJQUFJLHVCQUFhLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNoQyxhQUFhO0lBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDSCxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEIsWUFBWTtJQUNiLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY29uc3QgREVGQVVMVF9BQ1RJVkFUSU9OX0ZVTkNUSU9OID0gc2lnbW9pZDtcblxudHlwZSBBY3RpdmF0aW9uRnVuY3Rpb24gPSAobnVtYmVyKSA9PiBudW1iZXI7XG5cblxuZXhwb3J0IGludGVyZmFjZSBFeGFtcGxlIHtcblx0aW5wdXRzOiBudW1iZXJbXTtcblx0b3V0cHV0czogbnVtYmVyW107XG59XG5cblxuZXhwb3J0IGNsYXNzIE5ldXJvbiB7XG5cdHdlaWdodHM6IG51bWJlcltdO1xuXHRvdXRwdXQ6IG51bWJlcjtcblxuXHRjb25zdHJ1Y3RvcihudW1XZWlnaHRzOiBudW1iZXIpIHtcblx0XHR0aGlzLm91dHB1dCA9IE5hTjtcblx0XHR0aGlzLndlaWdodHMgPSBbXTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG51bVdlaWdodHM7IGkrKylcblx0XHRcdHRoaXMud2VpZ2h0cy5wdXNoKE1hdGgucmFuZG9tKCkpO1xuXHR9XG59XG5cblxuZXhwb3J0IGNsYXNzIE5ldXJhbE5ldHdvcmsge1xuXHRoaWRkZW5MYXllcjogTmV1cm9uW107XG5cdG91dHB1dExheWVyOiBOZXVyb25bXTtcblx0Ly8gVHVuYWJsZSBwYXJhbWV0ZXJzXG5cdGFjdGl2YXRpb25GdW5jOiBBY3RpdmF0aW9uRnVuY3Rpb247XG5cdGVwc2lsb246IG51bWJlcjtcblx0YWNjZXB0YWJsZUVycm9yOiBudW1iZXI7XG5cdG1heExlYXJuSXRlcmF0aW9uczogbnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgbnVtSW5wdXRzOiBudW1iZXIsIHByaXZhdGUgbnVtSGlkZGVuOiBudW1iZXIsIHByaXZhdGUgbnVtT3V0cHV0czogbnVtYmVyKSB7XG5cdFx0Ly8gSW5pdGlhbGl6ZSBkZWZhdWx0IHBhcmFtc1xuXHRcdHRoaXMuYWN0aXZhdGlvbkZ1bmMgPSBERUZBVUxUX0FDVElWQVRJT05fRlVOQ1RJT047XG5cdFx0dGhpcy5lcHNpbG9uID0gMC41O1xuXHRcdHRoaXMuYWNjZXB0YWJsZUVycm9yID0gMC4wMDE7XG5cdFx0dGhpcy5tYXhMZWFybkl0ZXJhdGlvbnMgPSAxMDAwO1xuXHRcdC8vIEluaXRpYWxpemUgbGF5ZXJzXG5cdFx0dGhpcy5oaWRkZW5MYXllciA9IFtdO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbnVtSGlkZGVuOyBpKyspXG5cdFx0XHR0aGlzLmhpZGRlbkxheWVyLnB1c2gobmV3IE5ldXJvbih0aGlzLm51bUlucHV0cyArIDEpKTtcblx0XHR0aGlzLm91dHB1dExheWVyID0gW107XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBudW1PdXRwdXRzOyBpKyspXG5cdFx0XHR0aGlzLm91dHB1dExheWVyLnB1c2gobmV3IE5ldXJvbih0aGlzLm51bUhpZGRlbiArIDEpKTtcblx0fVxuXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIEZvcndhcmQgcHJvcGFnYXRpb24gLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXHRmb3J3YXJkTmV1cm9uKG5ldXJvbjogTmV1cm9uLCBpbnB1dHM6IG51bWJlcltdKTogbnVtYmVyIHtcblx0XHRpZiAoaW5wdXRzLmxlbmd0aCAhPSBuZXVyb24ud2VpZ2h0cy5sZW5ndGgpXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc2l6ZSBvZiBpbnB1dCBhcnJheTogZXhwZWN0aW5nICR7bmV1cm9uLndlaWdodHMubGVuZ3RofSwgZ290ICR7aW5wdXRzLmxlbmd0aH1gKTtcblx0XHRsZXQgd2VpZ2h0ZWRTdW0gPSBpbnB1dHMucmVkdWNlKFxuXHRcdFx0KGFjY3VtLCBpbnB1dCwgaSkgPT4gYWNjdW0gKyBpbnB1dCAqIG5ldXJvbi53ZWlnaHRzW2ldLCAwKTtcblx0XHRuZXVyb24ub3V0cHV0ID0gdGhpcy5hY3RpdmF0aW9uRnVuYyh3ZWlnaHRlZFN1bSk7XG5cdFx0cmV0dXJuIG5ldXJvbi5vdXRwdXQ7XG5cdH1cblxuXHRmb3J3YXJkKGlucHV0czogbnVtYmVyW10pOiBudW1iZXJbXSB7XG5cdFx0bGV0IGhsVmFsdWVzOiBudW1iZXJbXSA9IFtdO1xuXHRcdGxldCBvdXRWYWx1ZXM6IG51bWJlcltdID0gW107XG5cdFx0dGhpcy5oaWRkZW5MYXllci5mb3JFYWNoKG5ldXJvbiA9PlxuXHRcdFx0aGxWYWx1ZXMucHVzaCh0aGlzLmZvcndhcmROZXVyb24obmV1cm9uLCB0aGlzLmFkZEJpYXMoaW5wdXRzKSkpXG5cdFx0KTtcblx0XHRobFZhbHVlcy5wdXNoKDEpO1x0XHQvLyBBZGQgYmlhc1xuXHRcdHRoaXMub3V0cHV0TGF5ZXIuZm9yRWFjaChuZXVyb24gPT5cblx0XHRcdG91dFZhbHVlcy5wdXNoKHRoaXMuZm9yd2FyZE5ldXJvbihuZXVyb24sIGhsVmFsdWVzKSlcblx0XHQpO1xuXHRcdHJldHVybiBvdXRWYWx1ZXM7XG5cdH1cblxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLSBCYWNrIHByb3BhZ2F0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0YmFja1Byb3BhZ2F0ZShpbnB1dHM6IG51bWJlcltdLCB0YXJnZXRzOiBudW1iZXJbXSk6IHZvaWQge1xuXHRcdC8vIEFkanVzdCB3ZWlnaHRzIGZvciBvdXRwdXQgbGF5ZXJcblx0XHRsZXQgaGlkZGVuT3V0cyA9IHRoaXMuaGlkZGVuTGF5ZXIubWFwKG5ldXJvbiA9PiBuZXVyb24ub3V0cHV0KTtcblx0XHRsZXQgaGlkZGVuRXJyb3JzOiBudW1iZXJbXSA9IFtdO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5oaWRkZW5MYXllci5sZW5ndGg7IGkrKykgaGlkZGVuRXJyb3JzLnB1c2goMCk7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm91dHB1dExheWVyLmxlbmd0aDsgaSsrKVxuXHRcdFx0dGhpcy5iYWNrUHJvcGFnYXRlT3V0TmV1cm9uKFxuXHRcdFx0XHR0aGlzLm91dHB1dExheWVyW2ldLCB0YXJnZXRzW2ldLCB0aGlzLmFkZEJpYXMoaGlkZGVuT3V0cyksIGhpZGRlbkVycm9ycyk7XG5cdFx0Ly8gQWRqdXN0IHdlaWdodHMgZm9yIGhpZGRlbiBsYXllclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5oaWRkZW5MYXllci5sZW5ndGg7IGkrKylcblx0XHRcdHRoaXMuYmFja1Byb3BhZ2F0ZUhpZGRlbk5ldXJvbihcblx0XHRcdFx0dGhpcy5oaWRkZW5MYXllcltpXSwgaGlkZGVuRXJyb3JzW2ldLCB0aGlzLmFkZEJpYXMoaW5wdXRzKSk7XG5cdH1cblxuXHRiYWNrUHJvcGFnYXRlT3V0TmV1cm9uKG5ldXJvbjogTmV1cm9uLCB0YXJnZXQ6IG51bWJlcixcblx0XHRwcmV2TGF5ZXJPdXRzOiBudW1iZXJbXSwgcHJldkxheWVyRXJyb3JzOiBudW1iZXJbXSk6IHZvaWQge1xuXHRcdGxldCBkZWx0YSA9ICh0YXJnZXQgLSBuZXVyb24ub3V0cHV0KSAqIG5ldXJvbi5vdXRwdXQgKiAoMSAtIG5ldXJvbi5vdXRwdXQpO1xuXHRcdGZvciAobGV0IGogPSAwOyBqIDwgbmV1cm9uLndlaWdodHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdHByZXZMYXllckVycm9yc1tqXSArPSBkZWx0YSAqIG5ldXJvbi53ZWlnaHRzW2pdO1xuXHRcdFx0bmV1cm9uLndlaWdodHNbal0gKz0gdGhpcy5lcHNpbG9uICogZGVsdGEgKiBwcmV2TGF5ZXJPdXRzW2pdO1xuXHRcdH1cblx0XHQvLyBkZWx0YSA6PSAoRFtqXSAtIFlbal0pICogWVtqXSAqICgxIC0gWVtqXSk7XG5cdFx0Ly8gcGVyIG9nbmkgdW5pdMOgIGsgZGVsIGxpdmVsbG8gSCAoY29tcHJlc28gYmlhcylcblx0XHQvLyAgICBFcnJIW2tdIDo9IEVyckhba10gKyAoZGVsdGEgKiBXMltrLGpdKTtcblx0XHQvLyAgICBXMltrLGpdIDo9IFcyW2ssal0gKyAoZXBzaWxvbiAqIGRlbHRhICogSFtrXSk7XG5cdH1cblxuXHRiYWNrUHJvcGFnYXRlSGlkZGVuTmV1cm9uKG5ldXJvbjogTmV1cm9uLCBlcnJvcjogbnVtYmVyLCBpbnB1dHM6IG51bWJlcltdKTogdm9pZCB7XG5cdFx0bGV0IGRlbHRhID0gZXJyb3IgKiBuZXVyb24ub3V0cHV0ICogKDEgLSBuZXVyb24ub3V0cHV0KTtcblx0XHRmb3IgKGxldCBqID0gMDsgaiA8IG5ldXJvbi53ZWlnaHRzLmxlbmd0aDsgaisrKVxuXHRcdFx0bmV1cm9uLndlaWdodHNbal0gKz0gdGhpcy5lcHNpbG9uICogZGVsdGEgKiBpbnB1dHNbal07XG5cdFx0Ly8gZGVsdGEgOj0gRXJySFtrXSAqIEhba10gKiAoMSAtIEhba10pO1xuXHRcdC8vIHBlciBvZ25pIHVuaXTDoCBpIGRlbCBsaXZlbGxvIFggKGNvbXByZXNvIGJpYXMpXG5cdFx0Ly8gICAgV2xbaSxrXSA6PSBXbFtpLGtdICsgKGVwc2lsb24gKiBkZWx0YSAqIFhbaV0pO1xuXHR9XG5cblx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0gSXRlcmF0aXZlIGxlYXJuaW5nIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0bGVhcm4oZXhhbXBsZXM6IEV4YW1wbGVbXSk6IG51bWJlciB7XG5cdFx0bGV0IGl0ZXJhdGlvbiA9IDA7XG5cdFx0bGV0IHRvdGFsRXJyb3IgPSAwO1xuXHRcdGRvIHtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZXhhbXBsZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0bGV0IGFjdHVhbE91dHMgPSB0aGlzLmZvcndhcmQoZXhhbXBsZXNbaV0uaW5wdXRzKTtcblx0XHRcdFx0bGV0IGV4cGVjdGVkT3V0cyA9IGV4YW1wbGVzW2ldLm91dHB1dHM7XG5cdFx0XHRcdHRoaXMuYmFja1Byb3BhZ2F0ZShleGFtcGxlc1tpXS5pbnB1dHMsIGV4cGVjdGVkT3V0cyk7XG5cdFx0XHRcdHRvdGFsRXJyb3IgPSB0aGlzLnRvdGFsRXJyb3IoYWN0dWFsT3V0cywgZXhwZWN0ZWRPdXRzKTtcblx0XHRcdH1cblx0XHRcdGl0ZXJhdGlvbisrO1xuXHRcdFx0dGhpcy5yZXBvcnRMZWFybihpdGVyYXRpb24sIHRvdGFsRXJyb3IpO1xuXHRcdH0gd2hpbGUgKGl0ZXJhdGlvbiA8IHRoaXMubWF4TGVhcm5JdGVyYXRpb25zICYmIHRvdGFsRXJyb3IgPiB0aGlzLmFjY2VwdGFibGVFcnJvcik7XG5cdFx0cmV0dXJuIGl0ZXJhdGlvbjtcblx0XHQvLyByaXBldGkgKCogZXBvY2hlICopXG5cdFx0Ly8gXHQgcGVyIG9nbmkgZXNlbXBpbyB7WCxEfVxuXHRcdC8vIFx0XHRlc2VndWkgbGEgcmV0ZSBjb24gWCBlIHRyb3ZhIFk7XG5cdFx0Ly8gXHRcdGJhY2twcm9wYWdhdGU7XG5cdFx0Ly8gXHQgZmluZTtcblx0XHQvLyBcdCBjYWxjb2xhIGVycm9yZSBkZWxsJ2ludGVyYSBlcG9jYTtcblx0XHQvLyBmaW5jaMOpIGVycm9yZSBkZWxsJ2Vwb2NhIGluZmVyaW9yZSBhZCBlcnJvcmUgYW1tZXNzb1xuXHR9XG5cblx0cmVwb3J0TGVhcm4oaXRlcmF0aW9uLCB0b3RhbEVycm9yKSB7XG5cdFx0Y29uc29sZS5sb2coYExlYXJuIGl0ZXJhdGlvbiAke2l0ZXJhdGlvbn0gLSBlcnJvcjogJHt0b3RhbEVycm9yfWApO1xuXHR9XG5cblx0dG90YWxFcnJvcihhY3R1YWxPdXRzOiBudW1iZXJbXSwgZXhwZWN0ZWRPdXRzOiBudW1iZXJbXSk6IG51bWJlciB7XG5cdFx0Y29uc3Qgc3F1YXJlID0geCA9PiB4ICogeDtcblx0XHRsZXQgc3VtID0gYWN0dWFsT3V0cy5yZWR1Y2UoXG5cdFx0XHQoYWNjdW0sIGFjdHVhbE91dCwgaSkgPT4gYWNjdW0gKyBzcXVhcmUoYWN0dWFsT3V0IC0gZXhwZWN0ZWRPdXRzW2ldKSwgMCk7XG5cdFx0cmV0dXJuIHN1bSAvIDI7XG5cdH1cblxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLSBNaXNjIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0YWRkQmlhcyh2YWx1ZXM6IG51bWJlcltdKTogbnVtYmVyW10ge1xuXHRcdGxldCBiaWFzZWRWYWx1ZXMgPSB2YWx1ZXMuc2xpY2UoKTtcblx0XHRiaWFzZWRWYWx1ZXMucHVzaCgxKTtcblx0XHRyZXR1cm4gYmlhc2VkVmFsdWVzO1xuXHR9XG59XG5cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0gQWN0aXZhdGlvbiBmdW5jdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gc2lnbW9pZCh4OiBudW1iZXIpOiBudW1iZXIge1xuXHRpZiAoeCA8IC00NS4wKSByZXR1cm4gMC4wO1xuXHRlbHNlIGlmICh4ID4gNDUuMCkgcmV0dXJuIDEuMDtcblx0ZWxzZSByZXR1cm4gMS4wIC8gKDEuMCArIE1hdGguZXhwKC14KSk7XG59XG4iLCJpbXBvcnQgeyBOZXVyYWxOZXR3b3JrIH0gZnJvbSAnLi9uZXVyb25zJztcblxubGV0IG5uOiBOZXVyYWxOZXR3b3JrO1xuXG4kKGZ1bmN0aW9uKCkge1xuXHQkKCdpbnB1dCx0ZXh0YXJlYScpLm9uKCdpbnB1dCcsIGV2dCA9PiB7XG5cdFx0Ly9UT0RPOiB2YWxpZGF0ZSBhbmQgYWN0aXZhdGUgYnV0dG9uc1xuXHR9KTtcblx0JCgnI2J1dGxlYXJuJykuY2xpY2soXyA9PiB7XG5cdFx0bm4gPSBuZXcgTmV1cmFsTmV0d29yaygzLCA0LCAzKTtcblx0XHQvL1RPRE86IGxlYXJuXG5cdH0pO1xuXHQkKCcjYnV0dGVzdCcpLmNsaWNrKF8gPT4ge1xuXHRcdC8vVE9ETzogdGVzdFxuXHR9KTtcbn0pO1xuIl19
